name: controllers
buildsystem: simple
build-commands:
  - systemd-hwdb update --usr --strict
modules:
  - name: hwdata
    config-opts:
      - --datarootdir=/app/share
    sources:
      - type: archive
        url: https://github.com/vcrhonek/hwdata/archive/v0.323.tar.gz
        sha256: ab0ad297e30a1fe9d96fe27ef982d6a9f4e04e7b9977225954d9f1890b05d651

  - name: systemd
    buildsystem: meson
    config-opts:
      - -Drootprefix=/app
      - -Dsysconfdir=/app/etc
      - -Denvironment-d=false
      - -Dbinfmt=false
      - -Dcoredump=false
      - -Dlogind=false
      - -Dhostnamed=false
      - -Dlocaled=false
      - -Dmachined=false
      - -Dportabled=false
      - -Dnetworkd=false
      - -Dtimedated=false
      - -Dtimesyncd=false
      - -Dremote=false
      - -Dfirstboot=false
      - -Drandomseed=false
      - -Dbacklight=false
      - -Dvconsole=false
      - -Dquotacheck=false
      - -Dsysusers=false
      - -Dtmpfiles=false
      - -Dimportd=false
      - -Dhwdb=true
      - -Drfkill=false
      - -Dman=false
      - -Dhtml=false
      - -Dpam=false
      - -Dmicrohttpd=false
      - -Dbashcompletiondir=no
      - -Dzshcompletiondir=no
    sources:
      - type: archive
        url: https://github.com/systemd/systemd/archive/v242.tar.gz
        sha256: ec22be9a5dd94c9640e6348ed8391d1499af8ca2c2f01109198a414cff6c6cba
    cleanup:
      - /bin
      - /etc
      - /lib/systemd
      - /lib/sysctl.d
      - /lib/udev/rules.d
      - /lib/modprobe.d
      - /lib/kernel
      - /lib/rpm
      - /share/polkit-1
      - /share/dbus-1
      - /share/factory

  - name: libusb
    sources:
      - type: archive
        url: https://github.com//libusb/libusb/releases/download/v1.0.22/libusb-1.0.22.tar.bz2
        sha256: 75aeb9d59a4fdb800d329a545c2e6799f732362193b465ea198f2aa275518157

  - name: usbutils
    config-opts:
      - --datadir=/app/share/hwdata
    sources:
      - type: archive
        url: https://mirrors.edge.kernel.org/pub/linux/utils/usb/usbutils/usbutils-010.tar.xz
        sha256: 61c7364bb4986fb05e5067e4ac5585b1299b664c57f761caecd2e9e724794a19
      - type: patch
        path: patches/0004-lsusb.py-fix-up-Python-3-conversion.patch